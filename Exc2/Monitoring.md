## Выбор и настройка мониторинга в системе

### Мотивация
С ростом количества клиентов, система испытывает повышенную нагрузку, что ведет к сбоям и отказам и, как следствие, негативно влияет на пользовательский опыт.
При текущей архитектуре системы, у команды разработки нет возможности прогнозировать поведение системы, выявлять проблемные и узкие места, своевременно реагировать на инциденты, связанные с недоступностью и заранее предупреждать их.

Внедрение мониторинга даст возможность избегать простоев системы, улучшит пользовательский опыт.

### Выбор подхода к мониторингу

CRM: подход "Четыре золотых сигнала"
Онлайн-магазин: подход "Четыре золотых сигнала"
MES: подход "Четыре золотых сигнала"
БД: подход RED
RabbitMQ: подход RED
S3: подход RED

### Метрики
  - Онлайн-магазин
 
| Метрика                                                 | Назначение                                   |
|---------------------------------------------------------|----------------------------------------------|
| Number of requests (RPS) for internet shop API          | Оценка количества запросов                   |
| Number of requests (RPS) per user for internet shop API | Оценка количества запросов по пользователям  |
| CPU % for shop API                                      | Оценка утилизации ресурсов ЦП                |
| Memory Utilisation for shop API                         | Оценка утилизации памяти                     |
| Response time (latency) for shop API                    | Оценка задержки ответа                       |
| Number of HTTP 200 for shop API                         | Оценка количества успешных запросов к API    |
| Number of HTTP 500 for shop API                         | Оценка количества не успешных запросов к API |
| Number of simulations sessions for shop API             | Оценка количества пользователей системы      |
| Kb transferred (received) for shop API                  | Оценка объема полученных данных              |
| Kb provided (sent) for shop API                         | Оценка объема переданных  данных             |

  - БД Онлайн-магазина

| Метрика                                     | Назначение                           |
|---------------------------------------------|--------------------------------------|
| Memory Utilisation for shop db instance     | Оценка использования ресурсов памяти |
| Number of connections for shop db instance  | Оценка количества подключений к БД   |
| Size of shop db instance                    | Оценка размера БД                    |

  - RabbitMQ

| Метрика                                               | Назначение                                       |
|-------------------------------------------------------|--------------------------------------------------|
| Number of dead-letter-exchange letters in RabbitMQ    | Мониторинг проблем обработки сообщений           |
| Number of message in flight in RabbitMQ               | Оценка текущей рабочей нагрузки в очереди        |

   - S3

| Метрика | Назначение                                                             |
|---------|------------------------------------------------------------------------|
| Size of S3 storage       | Отслеживание размера хранилища для предотвращения переполнения         |

  - CRM

| Метрика                                       | Назначение                                   |
|-----------------------------------------------|----------------------------------------------|
| Number of requests (RPS) for CRM API          | Оценка количества запросов                   |
| Number of requests (RPS) per user for CRM API | Оценка количества запросов по пользователям  |
| CPU % for CRM API                             | Оценка утилизации ресурсов ЦП                |
| Memory Utilisation for CRM API                | Оценка утилизации памяти                     |
| Response time (latency) for CRM API           | Оценка задержки ответа                       |
| Number of HTTP 200 for CRM API                | Оценка количества успешных запросов к API    |
| Number of HTTP 500 for CRM API                | Оценка количества не успешных запросов к API |
| Number of simulations sessions for CRM API    | Оценка количества пользователей системы      |
| Kb transferred (received) for CRM API         | Оценка объема полученных данных              |
| Kb provided (sent) for CRM API                | Оценка объема переданных  данных             |

  - MES

| Метрика                                       | Назначение                                   |
|-----------------------------------------------|----------------------------------------------|
| Number of requests (RPS) for MES API          | Оценка количества запросов                   |
| Number of requests (RPS) per user for MES API | Оценка количества запросов по пользователям  |
| CPU % for MES API                             | Оценка утилизации ресурсов ЦП                |
| Memory Utilisation for MES API                | Оценка утилизации памяти                     |
| Response time (latency) for MES API           | Оценка задержки ответа                       |
| Number of HTTP 200 for MES API                | Оценка количества успешных запросов к API    |
| Number of HTTP 500 for MES API                | Оценка количества не успешных запросов к API |
| Number of simulations sessions for MES API    | Оценка количества пользователей системы      |
| Kb transferred (received) for MES API         | Оценка объема полученных данных              |
| Kb provided (sent) for MES API                | Оценка объема переданных  данных             |

  - БД MES

| Метрика                                   | Назначение                           |
|-------------------------------------------|--------------------------------------|
| Memory Utilisation for MES db instance    | Оценка использования ресурсов памяти |
| Number of connections for MES db instance | Оценка количества подключений к БД   |
| Size of MES db instance                   | Оценка размера БД                    |


### План действий
  1. Развернуть экспортеры метрик: node и jmx exporter;
  2. Развернуть Prometheus, настроить scrape_config на получение метрик;
  3. Развернуть Grafana Для визуализации метрик, настроить подключение к Prometheus.
  4. Настроить в Grafana дашборды, алерты, отправку уведомлений по критичным метрикам.
